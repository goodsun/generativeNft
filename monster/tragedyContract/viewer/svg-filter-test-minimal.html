<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minimal SVG Filter Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test {
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        svg {
            border: 1px solid #444;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Minimal SVG Filter Test</h1>

    <div class="test">
        <h3>Test 1: Inline SVG with Base64 image and filter</h3>
        <div id="test1"></div>
    </div>

    <div class="test">
        <h3>Test 2: Dynamic SVG creation</h3>
        <div id="test2"></div>
    </div>

    <div class="test">
        <h3>Test 3: Arweave + Local with filter</h3>
        <div id="test3"></div>
    </div>

    <script>
        // Test 1: Direct inline SVG
        document.getElementById('test1').innerHTML = `
            <svg width="240" height="240" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <filter id="greenFilter">
                        <feColorMatrix type="matrix" values="0.8 0.2 0 0 0.1 0.2 1.5 0.2 0 0 0 0.3 0.7 0 0 0 0 0 1 0"/>
                    </filter>
                </defs>
                <rect x="0" y="0" width="24" height="24" fill="#333"/>
                <circle cx="12" cy="12" r="8" fill="#ff6b6b" filter="url(#greenFilter)"/>
            </svg>
        `;

        // Test 2: Dynamic creation
        async function test2() {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '240');
            svg.setAttribute('height', '240');
            svg.setAttribute('viewBox', '0 0 24 24');
            
            // Create defs
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            
            // Create filter
            const filter = document.createElementNS('http://www.w3.org/2000/svg', 'filter');
            filter.setAttribute('id', 'dynamicFilter');
            
            const colorMatrix = document.createElementNS('http://www.w3.org/2000/svg', 'feColorMatrix');
            colorMatrix.setAttribute('type', 'matrix');
            colorMatrix.setAttribute('values', '1.5 0.5 0.5 0 0 0.3 1.0 0.3 0 0 0.1 0.1 0.8 0 0 0 0 0 1 0');
            
            filter.appendChild(colorMatrix);
            defs.appendChild(filter);
            svg.appendChild(defs);
            
            // Add background
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', '0');
            rect.setAttribute('y', '0');
            rect.setAttribute('width', '24');
            rect.setAttribute('height', '24');
            rect.setAttribute('fill', '#222');
            svg.appendChild(rect);
            
            // Add filtered circle
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', '12');
            circle.setAttribute('cy', '12');
            circle.setAttribute('r', '8');
            circle.setAttribute('fill', '#4ecdc4');
            circle.setAttribute('filter', 'url(#dynamicFilter)');
            svg.appendChild(circle);
            
            document.getElementById('test2').appendChild(svg);
        }
        test2();

        // Test 3: Real data test
        async function test3() {
            try {
                // Load werewolf SVG
                const response = await fetch('./assets/monsters/werewolf.svg');
                const svgText = await response.text();
                const base64 = btoa(unescape(encodeURIComponent(svgText)));
                const dataUri = `data:image/svg+xml;base64,${base64}`;
                
                // Create SVG string - FIXED: filter must be inside defs
                const svgString = `<svg width="240" height="240" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <filter id="test3Filter">
                            <feColorMatrix values="0.8 0.2 0 0 0.1 0.2 1.5 0.2 0 0 0 0.3 0.7 0 0 0 0 0 1 0"/>
                        </filter>
                    </defs>
                    <rect x="0" y="0" width="24" height="24" fill="#1a1a1a"/>
                    <image href="${dataUri}" x="0" y="0" width="24" height="24" filter="url(#test3Filter)"/>
                </svg>`;
                
                document.getElementById('test3').innerHTML = svgString;
                
                // Also try without filter for comparison
                const svgStringNoFilter = `<svg width="240" height="240" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0" y="0" width="24" height="24" fill="#1a1a1a"/>
                    <image href="${dataUri}" x="0" y="0" width="24" height="24"/>
                </svg>`;
                
                document.getElementById('test3').innerHTML += svgStringNoFilter;
                
            } catch (error) {
                document.getElementById('test3').innerHTML = `Error: ${error.message}`;
            }
        }
        test3();
    </script>
</body>
</html>