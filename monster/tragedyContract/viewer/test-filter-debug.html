<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Filter Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .test-box {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        h3 {
            color: #ff6b6b;
            margin: 0 0 10px 0;
        }
        .debug-info {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
        svg {
            border: 1px solid #444;
            background: #000;
        }
    </style>
</head>
<body>
    <h1>SVG Filter Debug Test</h1>

    <h2>Test 1: Inline SVG with Filter</h2>
    <div class="test-container">
        <div class="test-box">
            <h3>No Filter</h3>
            <svg width="200" height="200" viewBox="0 0 100 100">
                <rect x="20" y="20" width="60" height="60" fill="#ff6b6b"/>
            </svg>
        </div>
        <div class="test-box">
            <h3>With Filter (Direct)</h3>
            <svg width="200" height="200" viewBox="0 0 100 100">
                <rect x="20" y="20" width="60" height="60" fill="#ff6b6b" style="filter: hue-rotate(90deg) saturate(200%)"/>
            </svg>
        </div>
        <div class="test-box">
            <h3>With Filter (Group)</h3>
            <svg width="200" height="200" viewBox="0 0 100 100">
                <g style="filter: hue-rotate(90deg) saturate(200%)">
                    <rect x="20" y="20" width="60" height="60" fill="#ff6b6b"/>
                </g>
            </svg>
        </div>
    </div>

    <h2>Test 2: External Image with Filter</h2>
    <div class="test-container">
        <div class="test-box">
            <h3>Local SVG - No Filter</h3>
            <svg width="200" height="200" viewBox="0 0 24 24">
                <image href="./assets/monsters/werewolf.svg" x="0" y="0" width="24" height="24"/>
            </svg>
            <div class="debug-info">No style attribute</div>
        </div>
        <div class="test-box">
            <h3>Local SVG - With Filter</h3>
            <svg width="200" height="200" viewBox="0 0 24 24">
                <image href="./assets/monsters/werewolf.svg" x="0" y="0" width="24" height="24" style="filter: hue-rotate(90deg) saturate(200%) brightness(120%)"/>
            </svg>
            <div class="debug-info">style="filter: hue-rotate(90deg) saturate(200%) brightness(120%)"</div>
        </div>
        <div class="test-box">
            <h3>Data URI - With Filter</h3>
            <div id="data-uri-test"></div>
            <div class="debug-info" id="data-uri-debug">Loading...</div>
        </div>
    </div>

    <h2>Test 3: Dynamic Filter Application</h2>
    <div class="test-container">
        <div class="test-box">
            <h3>Select Background</h3>
            <select id="bg-select" style="width: 100%; padding: 5px; background: #333; color: #fff; border: 1px solid #555;">
                <option value="">None</option>
                <option value="Bloodmoon">Bloodmoon</option>
                <option value="Venom">Venom</option>
                <option value="Frost">Frost</option>
            </select>
        </div>
        <div class="test-box">
            <h3>Dynamic Result</h3>
            <div id="dynamic-result"></div>
            <div class="debug-info" id="dynamic-debug">Select a background</div>
        </div>
        <div class="test-box">
            <h3>Filter String</h3>
            <div class="debug-info" id="filter-string">No filter</div>
        </div>
    </div>

    <script>
        // Background filters
        const backgroundFilters = {
            Bloodmoon: {
                hueRotate: 0,
                saturate: 150,
                brightness: 110,
                contrast: 120,
                sepia: 30
            },
            Venom: {
                hueRotate: 90,
                saturate: 200,
                brightness: 105,
                contrast: 130,
                sepia: 0
            },
            Frost: {
                hueRotate: 200,
                saturate: 110,
                brightness: 115,
                contrast: 105,
                sepia: 0
            }
        };

        function createFilterString(bgKey) {
            const filter = backgroundFilters[bgKey];
            if (!filter) return '';
            
            let filterString = `hue-rotate(${filter.hueRotate}deg) saturate(${filter.saturate}%) brightness(${filter.brightness}%) contrast(${filter.contrast}%)`;
            if (filter.sepia > 0) {
                filterString += ` sepia(${filter.sepia}%)`;
            }
            
            return filterString;
        }

        // Test with data URI
        async function testDataUri() {
            try {
                const response = await fetch('./assets/monsters/werewolf.svg');
                const svgText = await response.text();
                const base64 = btoa(unescape(encodeURIComponent(svgText)));
                const dataUri = `data:image/svg+xml;base64,${base64}`;
                
                const svg = `
                    <svg width="200" height="200" viewBox="0 0 24 24">
                        <image href="${dataUri}" x="0" y="0" width="24" height="24" style="filter: hue-rotate(180deg) saturate(150%) brightness(110%)"/>
                    </svg>
                `;
                
                document.getElementById('data-uri-test').innerHTML = svg;
                document.getElementById('data-uri-debug').textContent = 'Data URI with filter: hue-rotate(180deg) saturate(150%) brightness(110%)';
            } catch (error) {
                document.getElementById('data-uri-test').innerHTML = '<p>Error loading</p>';
                document.getElementById('data-uri-debug').textContent = 'Error: ' + error.message;
            }
        }

        // Dynamic filter test
        document.getElementById('bg-select').addEventListener('change', function() {
            const bgKey = this.value;
            const filterString = createFilterString(bgKey);
            
            document.getElementById('filter-string').textContent = filterString || 'No filter';
            
            if (bgKey) {
                const svg = `
                    <svg width="200" height="200" viewBox="0 0 24 24">
                        <rect x="0" y="0" width="24" height="24" fill="#111"/>
                        <image href="./assets/monsters/werewolf.svg" x="0" y="0" width="24" height="24" style="filter: ${filterString}"/>
                    </svg>
                `;
                document.getElementById('dynamic-result').innerHTML = svg;
                document.getElementById('dynamic-debug').innerHTML = `Applied filter:<br>${filterString}`;
            } else {
                document.getElementById('dynamic-result').innerHTML = '<p>Select a background</p>';
                document.getElementById('dynamic-debug').textContent = 'No background selected';
            }
        });

        // Run tests on load
        testDataUri();
    </script>
</body>
</html>